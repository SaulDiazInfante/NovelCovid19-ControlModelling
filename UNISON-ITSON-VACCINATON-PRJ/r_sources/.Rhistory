elderly_cum_inc =
output$S3[1] - output$S3[nrow(output)],
total_cum_inc =
sum(output[1,c("S1", "S2", "S3")]) -
sum(output[nrow(output),c("S1", "S2", "S3")]))
vacc_cov1 <- 0
vacc_cov2 <- 0
vacc_cov3 <- 1
vacc_eff3 <- 0.5
p1 <- vacc_cov1
p2 <- vacc_cov2
p3 <- vacc_cov3 * vacc_eff3
N <- 1000000
N1 <- 0.2 * N
N2 <- 0.65 * N
N3 <- 0.15 * N
initial_state_values <- c(S1 = N1 - p1 * N1,
S2 = N2 - p2 * N2,
S3 = N3 - p3 * N3,
I1 = 1,
I2 = 0,
I3 = 0,
R1 = p1 * N1,
R2 = p2 * N2,
R3 = p3 * N3)
# Run model output
output <- as.data.frame(ode(y = initial_state_values,
times = times,
func = sir_age_model,
parms = parameters))
# Calculate cumulative incidence in each age group:
results3 <- data.frame(child_cum_inc =
output$S1[1] - output$S1[nrow(output)],
adult_cum_inc =
output$S2[1] - output$S2[nrow(output)],
elderly_cum_inc =
output$S3[1] - output$S3[nrow(output)],
total_cum_inc =
sum(output[1,c("S1", "S2", "S3")]) -
sum(output[nrow(output),c("S1", "S2", "S3")]))
print(rbind(results1, results2, results3))
```
```{r}
# Baseline prevalence (no vaccine)
vacc_cov1 <- 0
vacc_cov2 <- 0
vacc_cov3 <- 0
vacc_eff3 <- 0.5
# Effective vaccine coverage for each age group:
p1 <- vacc_cov1
p2 <- vacc_cov2
p3 <- vacc_cov3 * vacc_eff3
N <- 1000000
N1 <- 0.2 * N
N2 <- 0.65 * N
N3 <- 0.15 * N
# Fill in initial state values for a naive population based on effective vaccine coverage:
initial_state_values <- c(S1 = N1 - p1 * N1,
S2 = N2 - p2 * N2,
S3 = N3 - p3 * N3,
I1 = 1,        # the outbreak starts with 1 infected person (can be of either age)
I2 = 0,
I3 = 0,
R1 = p1 * N1,
R2 = p2 * N2,
R3 = p3 * N3)
# Run model output
output <- as.data.frame(ode(y = initial_state_values,
times = times,
func = sir_age_model,
parms = parameters))
# Calculate cumulative incidence in each age group:
baseline_results <-
data.frame(child_cum_inc =
output$S1[1] -
output$S1[nrow(output)],
adult_cum_inc =
output$S2[1] - output$S2[nrow(output)],
elderly_cum_inc =
output$S3[1] - output$S3[nrow(output)],
total_cum_inc = sum(output[1,c("S1", "S2", "S3")]) -
sum(output[nrow(output),c("S1", "S2", "S3")]))
vacc_cov1 <- 0.25
vacc_cov2 <- 0.25
vacc_cov3 <- 0.25
vacc_eff3 <- 0.5
p1 <- vacc_cov1
p2 <- vacc_cov2
p3 <- vacc_cov3 * vacc_eff3
N <- 1000000
N1 <- 0.2 * N
N2 <- 0.65 * N
N3 <- 0.15 * N
initial_state_values <- c(S1 = N1 - p1 * N1,
S2 = N2 - p2 * N2,
S3 = N3 - p3 * N3,
I1 = 1,
I2 = 0,
I3 = 0,
R1 = p1 * N1,
R2 = p2 * N2,
R3 = p3 * N3)
# Run model output
output <- as.data.frame(ode(y = initial_state_values,
times = times,
func = sir_age_model,
parms = parameters))
# Calculate cumulative incidence in each age group:
results4 <-
data.frame(child_cum_inc = output$S1[1] - output$S1[nrow(output)],
adult_cum_inc = output$S2[1] - output$S2[nrow(output)],
elderly_cum_inc = output$S3[1] - output$S3[nrow(output)],
total_cum_inc = sum(output[1,c("S1", "S2", "S3")]) -
sum(output[nrow(output),c("S1", "S2", "S3")]))
print(baseline_results)
print(results4)
```
# Calculate cumulative incidence in each age group:
results4 <-
data.frame(child_cum_inc = output$S1[1] - output$S1[nrow(output)],
adult_cum_inc = output$S2[1] - output$S2[nrow(output)],
elderly_cum_inc = output$S3[1] - output$S3[nrow(output)],
total_cum_inc =
sum(output[1, c("S1", "S2", "S3")]) -
sum(output[nrow(output), c("S1", "S2", "S3")]))
print(baseline_results)
print(results4)
install.packages("rstan")
install.packages("rstan")
library(gridExtra)
head(influenza_england_1978_school)
library(outbreaks)
library(tidyverse)
library(rstan)
library(gridExtra)
clear
install.packages("rstan")
clar
clear
install.packages("rstan", dependencies = TRUE)
install.packages("shinystan")
clear
remove.packages("rstan")
if (file.exists(".RData")) file.remove(".RData")
install.packages("rstan", repos = "https://cloud.r-project.org/", dependencies = TRUE)
?MHadaptive
library(MHadaptive)
?`MHadaptive-package`
?dnorm
dexp
?dexp
version
q()
q()
clear
ls
clear
setwd("~/Insync/saul.diazinfante@unison.mx/OneDrive Biz/UNISON/ARTICLES/Covid19/COVID19-Sonora/r_sources")
clear
source("raw_data_cleaning.R")
setwd("~/Insync/saul.diazinfante@unison.mx/OneDrive Biz/UNISON/ARTICLES/Covid19/COVID19-Sonora/r_sources")
setwd("~/Insync/saul.diazinfante@unison.mx/OneDrive Biz/UNISON/ARTICLES/Covid19/COVID19-Sonora/r_sources")
raw_data <- read_csv("./data/200706COVID19MEXICO.csv")
raw_data <- read_csv("./data/200706COVID19MEXICO.csv")
df <- data.frame(raw_data)
working_data <- df %>%
select(ID_REGISTRO,
SEXO,
ENTIDAD_NAC,
ENTIDAD_UM,
ENTIDAD_RES,
MUNICIPIO_RES,
TIPO_PACIENTE,
FECHA_SINTOMAS,
FECHA_DEF,
EDAD,
NEUMONIA,
DIABETES,
EPOC,
ASMA,
HIPERTENSION,
CARDIOVASCULAR,
OBESIDAD,
TABAQUISMO
)
reference_date <- as.Date('2020-03-01')
final_date_sample <-as.Date('2020-06-12')
raw_data_culiacan <- filter(working_data,
MUNICIPIO_RES == 6,
as.Date(FECHA_SINTOMAS) >= reference_date,
as.Date(FECHA_SINTOMAS) <= final_date_sample)
N <- 962871
N <- 962871
prevalence_date_data_culiacan <- raw_data_culiacan %>%
group_by(FECHA_SINTOMAS) %>%
summarise(
i_s = n()
)
raw_data_hermosillo <- filter(working_data, MUNICIPIO_RES == 30)
prevalence_date_data_hermosillo <- raw_data_hermosillo %>%
group_by(FECHA_SINTOMAS) %>%
summarise(
i_s = n()
)
write.csv(prevalence_date_data_culiacan, './data/culiacan_prevalence_data.csv')
write.csv(prevalence_date_data_hermosillo,
'./data/hermosillo_prevalence_data.csv')
pl_0 <- ggplot(prevalence_date_data_culiacan, aes(x = FECHA_SINTOMAS, y = i_s)) +
geom_point(shape = 1) +
# geom_line() +
geom_point(data = prevalence_date_data_hermosillo,
shape = 3,
color="darkred",
aes(x=FECHA_SINTOMAS, y=i_s))
# geom_line(data = prevalence_data_hermosillo)
integer_offset_culiacan <-
as.numeric(prevalence_date_data_culiacan$FECHA_SINTOMAS[1])
prevalence_data_culiacan <- prevalence_date_data_culiacan %>%
mutate(integer_time = as.numeric(FECHA_SINTOMAS) - integer_offset_culiacan)
integer_offset_hermosillo <-
as.numeric(prevalence_date_data_hermosillo$FECHA_SINTOMAS[1])
prevalence_data_hermosillo <- prevalence_date_data_hermosillo %>%
mutate(integer_time =
as.numeric(FECHA_SINTOMAS) - integer_offset_hermosillo) %>%
select(as.Date(FECHA_SINTOMAS) > reference_date )
pl_1 <- ggplot(data=prevalence_data_culiacan, aes(x = integer_time, y = i_s)) +
geom_point(shape = 1) +
geom_line() +
geom_point(data = prevalence_data_hermosillo,
shape = 3,
color = "darkred",
aes(x = integer_time, y=i_s))
write.csv(prevalence_data_culiacan, './data/culiacan_prevalence_data.csv')
write.csv(prevalence_data_hermosillo,
'./data/hermosillo_prevalence_data.csv')
pl_0
pl_0 <- ggplot(prevalence_date_data_culiacan, aes(x = FECHA_SINTOMAS, y = i_s)) +
geom_point(shape = 1) +
# geom_line() +
geom_point(data = prevalence_date_data_hermosillo,
shape = 3,
color="darkred",
aes(x=FECHA_SINTOMAS, y=i_s))
integer_offset_culiacan <-
as.numeric(prevalence_date_data_culiacan$FECHA_SINTOMAS[1])
prevalence_data_culiacan <- prevalence_date_data_culiacan %>%
mutate(integer_time = as.numeric(FECHA_SINTOMAS) - integer_offset_culiacan)
integer_offset_hermosillo <-
as.numeric(prevalence_date_data_hermosillo$FECHA_SINTOMAS[1])
prevalence_data_hermosillo <- prevalence_date_data_hermosillo %>%
mutate(integer_time =
as.numeric(FECHA_SINTOMAS) - integer_offset_hermosillo) %>%
select(as.Date(FECHA_SINTOMAS) > reference_date )
clear
head(raw_data_culiacan)
head(prevalence_data_culiacan)
library(tidyverse)
library(ggplot2)
setwd("~/Insync/saul.diazinfante@unison.mx/OneDrive Biz/UNISON/ARTICLES/Covid19/COVID19-Sonora/r_sources")
# Load the flu da1aset of reported cases
raw_data <- read_csv("./data/200706COVID19MEXICO.csv")
df <- data.frame(raw_data)
working_data <- df %>%
select(ID_REGISTRO,
SEXO,
ENTIDAD_NAC,
ENTIDAD_UM,
ENTIDAD_RES,
MUNICIPIO_RES,
TIPO_PACIENTE,
FECHA_SINTOMAS,
FECHA_DEF,
EDAD,
NEUMONIA,
DIABETES,
EPOC,
ASMA,
HIPERTENSION,
CARDIOVASCULAR,
OBESIDAD,
TABAQUISMO
library(tidyverse)
library(ggplot2)
setwd("~/Insync/saul.diazinfante@unison.mx/OneDrive Biz/UNISON/ARTICLES/Covid19/COVID19-Sonora/r_sources")
# Load the flu da1aset of reported cases
raw_data <- read_csv("./data/200706COVID19MEXICO.csv")
df <- data.frame(raw_data)
working_data <- df %>%
select(ID_REGISTRO,
SEXO,
ENTIDAD_NAC,
ENTIDAD_UM,
ENTIDAD_RES,
MUNICIPIO_RES,
TIPO_PACIENTE,
FECHA_SINTOMAS,
FECHA_DEF,
EDAD,
NEUMONIA,
DIABETES,
EPOC,
ASMA,
HIPERTENSION,
CARDIOVASCULAR,
OBESIDAD,
TABAQUISMO
)
View(df)
View(df)
reference_date <- as.Date('2020-03-01')
final_date_sample <- as.Date('2020-06-12')
raw_data_culiacan <- filter(working_data,
MUNICIPIO_RES == 6,
as.Date(FECHA_SINTOMAS) >= reference_date,
as.Date(FECHA_SINTOMAS) <= final_date_sample)
head(raw_data_culiacan)
head(working_data)
})
reference_date <- as.Date('2020-03-01')
final_date_sample <- as.Date('2020-06-12')
raw_data_culiacan <- filter(working_data,
MUNICIPIO_RES == 006,
as.Date(FECHA_SINTOMAS) >= reference_date,
as.Date(FECHA_SINTOMAS) <= final_date_sample)
head(working_data)
head(prevalence_data_culiacan)
raw_data_culiacan <- filter(working_data,
MUNICIPIO_RES == 006 #,
#as.Date(FECHA_SINTOMAS) >= reference_date,
#as.Date(FECHA_SINTOMAS) <= final_date_sample
)
head(raw_data_culiacan)
raw_data_culiacan <- filter(working_data,
MUNICIPIO_RES == 006 #,
#as.Date(FECHA_SINTOMAS) >= reference_date,
#as.Date(FECHA_SINTOMAS) <= final_date_sample
)
raw_data_culiacan <- filter(working_data,
MUNICIPIO_RES == 006 #,
#as.Date(FECHA_SINTOMAS) >= reference_date,
#as.Date(FECHA_SINTOMAS) <= final_date_sample
)
head(raw_data_culiacan)
head(working_data)
filter(working_data,
MUNICIPIO_RES == 006 #,
#as.Date(FECHA_SINTOMAS) >= reference_date,
#as.Date(FECHA_SINTOMAS) <= final_date_sample
)
filter(working_data, MUNICIPIO_RES == 006)
filter(working_data, MUNICIPIO_RES == 6)
filter(working_data, MUNICIPIO_RES == 6)
filter(working_data, MUNICIPIO_RES == 006)
head(working_data)
filter(working_data, MUNICIPIO_RES == 106)
filter(working_data, MUNICIPIO_RES == 6)
filter(working_data, MUNICIPIO_RES == 06)
filter(working_data, MUNICIPIO_RES == 006)
library(tidyverse)
library(ggplot2)
setwd("~/Insync/saul.diazinfante@unison.mx/OneDrive Biz/UNISON/ARTICLES/Covid19/COVID19-Sonora/r_sources")
# Load the flu da1aset of reported cases
raw_data <- read_csv("./data/200706COVID19MEXICO.csv")
df <- data.frame(raw_data)
working_data <- df %>%
select(ID_REGISTRO,
SEXO,
ENTIDAD_NAC,
ENTIDAD_UM,
ENTIDAD_RES,
MUNICIPIO_RES,
TIPO_PACIENTE,
FECHA_SINTOMAS,
FECHA_DEF,
EDAD,
NEUMONIA,
DIABETES,
EPOC,
ASMA,
HIPERTENSION,
CARDIOVASCULAR,
OBESIDAD,
TABAQUISMO
)
filter(working_data, MUNICIPIO_RES == 006)
head(raw_data)
raw_data
library(tidyverse)
library(ggplot2)
setwd("~/Insync/saul.diazinfante@unison.mx/OneDrive Biz/UNISON/ARTICLES/Covid19/COVID19-Sonora/r_sources")
# Load the flu da1aset of reported cases
raw_data <- read_csv("./data/200706COVID19MEXICO.csv")
df <- data.frame(raw_data)
working_data <- df %>%
select(ID_REGISTRO,
SEXO,
ENTIDAD_NAC,
ENTIDAD_UM,
ENTIDAD_RES,
MUNICIPIO_RES,
TIPO_PACIENTE,
FECHA_SINTOMAS,
FECHA_DEF,
EDAD,
NEUMONIA,
DIABETES,
EPOC,
ASMA,
HIPERTENSION,
CARDIOVASCULAR,
OBESIDAD,
TABAQUISMO
)
# identifiers
# CDMX: 09 DF
# SINALOA identifier: 25 SL
#   Culiacán: 006
# SONORA identifier: 26 SR
# Hermosillo clave_municipio: 030
#
reference_date <- as.Date('2020-03-01')
final_date_sample <- as.Date('2020-06-12')
raw_data_culiacan <- filter(working_data,
MUNICIPIO_RES == 006 #,
#as.Date(FECHA_SINTOMAS) >= reference_date,
#as.Date(FECHA_SINTOMAS) <= final_date_sample
)
View(working_data)
View(working_data)
raw_data_culiacan <- filter(working_data,
MUNICIPIO_RES == 006 #,
#as.Date(FECHA_SINTOMAS) >= reference_date,
#as.Date(FECHA_SINTOMAS) <= final_date_sample
)
raw_data_culiacan
raw_data_culiacan <- filter(working_data,
MUNICIPIO_RES == 6 #,
#as.Date(FECHA_SINTOMAS) >= reference_date,
#as.Date(FECHA_SINTOMAS) <= final_date_sample
)
raw_data_culiacan
raw_data_culiacan <- filter(working_data,
as.numeric(MUNICIPIO_RES) == 6 #,
#as.Date(FECHA_SINTOMAS) >= reference_date,
#as.Date(FECHA_SINTOMAS) <= final_date_sample
)
raw_data_culiacan
source("raw_data_cleaning.R")
source("raw_data_cleaning.R")
source("raw_data_cleaning.R")
raw_data
working_data["FECHA_SINTOMAS"]
reference_date <- as.Date('2020-03-01')
final_date_sample <- as.Date('2020-06-12')
raw_data_culiacan <- filter(working_data,
as.numeric(MUNICIPIO_RES) == 6 ,
as.Date(FECHA_SINTOMAS) >= reference_date,
as.Date(FECHA_SINTOMAS) <= final_date_sample
)
N <- 962871
prevalence_date_data_culiacan <- raw_data_culiacan %>%
group_by(FECHA_SINTOMAS) %>%
summarise(
i_s = n()
)
raw_data_hermosillo <- filter(working_data, MUNICIPIO_RES == 30)
prevalence_date_data_hermosillo <- raw_data_hermosillo %>%
group_by(FECHA_SINTOMAS) %>%
summarise(
i_s = n()
)
write.csv(prevalence_date_data_culiacan, './data/culiacan_prevalence_data.csv')
write.csv(prevalence_date_data_hermosillo,
'./data/hermosillo_prevalence_data.csv')
pl_0 <- ggplot(prevalence_date_data_culiacan, aes(x = FECHA_SINTOMAS, y = i_s)) +
geom_point(shape = 1) +
# geom_line() +
geom_point(data = prevalence_date_data_hermosillo,
shape = 3,
color="darkred",
aes(x=FECHA_SINTOMAS, y=i_s))
# geom_line(data = prevalence_data_hermosillo)
integer_offset_culiacan <-
as.numeric(prevalence_date_data_culiacan$FECHA_SINTOMAS[1])
prevalence_data_culiacan <- prevalence_date_data_culiacan %>%
mutate(integer_time = as.numeric(FECHA_SINTOMAS) - integer_offset_culiacan)
integer_offset_hermosillo <-
as.numeric(prevalence_date_data_hermosillo$FECHA_SINTOMAS[1])
prevalence_data_hermosillo <- prevalence_date_data_hermosillo %>%
mutate(integer_time =
as.numeric(FECHA_SINTOMAS) - integer_offset_hermosillo) %>%
select(as.Date(FECHA_SINTOMAS) > reference_date )
pl_1 <- ggplot(data=prevalence_data_culiacan, aes(x = integer_time, y = i_s)) +
geom_point(shape = 1) +
geom_line() +
geom_point(data = prevalence_data_hermosillo,
shape = 3,
color = "darkred",
aes(x = integer_time, y=i_s))
write.csv(prevalence_data_culiacan, './data/culiacan_prevalence_data.csv')
write.csv(prevalence_data_hermosillo,
'./data/hermosillo_prevalence_data.csv')
pl_0
View(raw_data_culiacan)
View(raw_data_culiacan)
reference_date <- as.Date('2020-03-01')
final_date_sample <- as.Date('2020-06-12')
raw_data_culiacan <- filter(working_data,
as.numeric(MUNICIPIO_RES) == 6 ,
as.Date(FECHA_SINTOMAS) == final_date_sample
)
raw_data_culiacan
